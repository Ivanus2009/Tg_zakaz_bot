# Настройка деплоя на Render (РЕКОМЕНДУЕТСЯ)

Render - лучший вариант: $7/мес или бесплатно (с засыпанием).

## Шаг 1: Регистрация

1. Откройте [render.com](https://render.com)
2. Нажмите **"Get Started for Free"**
3. Войдите через **GitHub**

## Шаг 2: Создание веб-сервиса

1. В Dashboard нажмите **"New +"** → **"Web Service"**
2. Подключите репозиторий `Ivanus2009/Tg_zakaz_bot`
3. Настройки:
   - **Name**: `tg-cafe-web` (или любое название)
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `uvicorn src.webapp.app:app --host 0.0.0.0 --port $PORT`
   - **Plan**: 
     - **Free** (засыпает после 15 мин) - для теста
     - **Starter ($7/мес)** - рекомендуется, не засыпает
4. Нажмите **"Create Web Service"**

## Шаг 3: Добавление переменных окружения (веб-сервис)

В настройках веб-сервиса → **Environment**:

```
YT_API_KEY=ваш_ключ_из_ytimes
YT_SHOP_GUID=bdd03b7e-4fd9-4081-bfc0-959229d79044
```

⚠️ `WEBAPP_URL` будет автоматически установлен после деплоя

## Шаг 4: Создание сервиса для бота

1. В Dashboard нажмите **"New +"** → **"Background Worker"**
2. Выберите тот же репозиторий `Ivanus2009/Tg_zakaz_bot`
3. Настройки:
   - **Name**: `tg-cafe-bot`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python src/bot/bot.py`
   - **Plan**: 
     - **Free** (засыпает) - для теста
     - **Starter ($7/мес)** - рекомендуется
4. Нажмите **"Create Background Worker"**

## Шаг 5: Переменные окружения для бота

В настройках бота → **Environment**:

```
TELEGRAM_BOT_TOKEN=8357146502:AAF9ZBFC3DUG64bpUNp-YGMg_JlDnXOtDHw
YT_API_KEY=ваш_ключ_из_ytimes
YT_SHOP_GUID=bdd03b7e-4fd9-4081-bfc0-959229d79044
WEBAPP_URL=https://your-web-service.onrender.com
```

⚠️ Замените `your-web-service.onrender.com` на реальный URL из веб-сервиса

## Шаг 6: Получение URL веб-сервиса

1. После деплоя веб-сервиса вы получите URL вида:
   `https://tg-cafe-web.onrender.com`
2. Скопируйте этот URL
3. Добавьте его в переменные окружения бота как `WEBAPP_URL`

## Шаг 7: Настройка бота в Telegram

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте `/mybots`
3. Выберите вашего бота
4. Выберите **"Bot Settings"** → **"Menu Button"**
5. Введите URL веб-сервиса из Render
6. Нажмите **"Set Menu Button"**

## Стоимость

- **Бесплатный тариф**: 
  - Приложение засыпает после 15 минут бездействия
  - Первый запрос после засыпания занимает ~30 секунд
  - Подходит для тестирования
  
- **Starter ($7/мес)**:
  - Приложение не засыпает
  - Постоянная работа
  - Рекомендуется для продакшена

## Обновление кода

После каждого `git push` Render автоматически:
1. Обнаружит изменения
2. Пересоберет проект
3. Перезапустит сервисы

## Мониторинг

В Render вы можете:
- Просматривать логи в реальном времени
- Видеть метрики использования
- Перезапускать сервисы
- Обновлять переменные окружения

## Troubleshooting

### Бот не отвечает:
- Проверьте логи сервиса бота в Render
- Убедитесь, что `TELEGRAM_BOT_TOKEN` правильный
- Проверьте, что сервис не заснул (если бесплатный тариф)

### Мини-приложение не открывается:
- Проверьте, что `WEBAPP_URL` правильный в переменных окружения бота
- Убедитесь, что веб-сервис запущен
- Проверьте логи веб-сервиса

### Приложение засыпает (бесплатный тариф):
- Первый запрос после засыпания занимает ~30 секунд
- Для постоянной работы перейдите на Starter ($7/мес)

